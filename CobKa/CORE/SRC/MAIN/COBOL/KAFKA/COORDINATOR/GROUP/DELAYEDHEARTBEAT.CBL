IDENTIFICATION DIVISION.
PROGRAM-ID. DELAYED-HEARTBEAT.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY KAFKA-COORDINATOR-GROUP.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 COORDINATOR PIC X(20).
01 GROUP-METADATA PIC X(20).
01 MEMBER-ID PIC X(20).
01 IS-PENDING PIC X.
01 TIMEOUT-MS PIC 9(9) COMP.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    MOVE COORDINATOR TO COORDINATOR.
    MOVE GROUP-METADATA TO GROUP.
    MOVE MEMBER-ID TO MEMBERID.
    MOVE IS-PENDING TO IS-PENDING.
    MOVE TIMEOUT-MS TO TIMEOUT-MS.

    PERFORM TRY-COMPLETE.
    PERFORM ON-EXPIRATION.
    PERFORM ON-COMPLETE.

    STOP RUN.

TRY-COMPLETE.
    CALL "TRY-COMPLETE-HEARTBEAT" USING COORDINATOR, GROUP, MEMBERID, IS-PENDING, FORCE-COMPLETE.
    IF RETURN-CODE = 1
        RETURN.

ON-EXPIRATION.
    CALL "ON-EXPIRE-HEARTBEAT" USING COORDINATOR, GROUP, MEMBERID, IS-PENDING.

ON-COMPLETE.
    CONTINUE.

FORCE-COMPLETE.
    MOVE 1 TO RETURN-CODE.