IDENTIFICATION DIVISION.
PROGRAM-ID. GROUP-COORDINATOR-ADAPTER.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY "kafka.common.group".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-COORDINATOR USAGE POINTER.
01 WS-TIME USAGE POINTER.
01 WS-METRICS USAGE POINTER.
01 WS-REQUEST-CONTEXT USAGE POINTER.
01 WS-BUFFER-SUPPLIER USAGE POINTER.
01 WS-FUTURE USAGE POINTER.
01 WS-CALLBACK USAGE POINTER.
01 WS-ASSIGNMENT-MAP USAGE POINTER.
01 WS-CURRENT-TIME-MS USAGE LONG-BINARY.
01 WS-EXPIRE-TIMESTAMP USAGE LONG-BINARY.
01 WS-PARTITIONS USAGE POINTER.
01 WS-RESPONSE USAGE POINTER.
01 WS-RESULTS USAGE POINTER.
01 WS-GROUP-IDS USAGE POINTER.
01 WS-TOPIC-PARTITIONS USAGE POINTER.
01 WS-TOPIC-PARTITION-RESULTS USAGE POINTER.
01 WS-REQUEST-LOCAL USAGE POINTER.

PROCEDURE DIVISION.

MAIN-PARAGRAPH.
    MOVE CONFIG TO WS-COORDINATOR.
    MOVE TIME TO WS-TIME.
    MOVE METRICS TO WS-METRICS.

    CALL "GROUP-COORDINATOR-ADAPTER-INIT" USING WS-COORDINATOR, WS-TIME, WS-METRICS.

    PERFORM FOREVER
        CALL "GROUP-COORDINATOR-ADAPTER-CONSUMER-GROUP-HEARTBEAT" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-SHARE-GROUP-HEARTBEAT" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-DESCRIBE-SHARE-GROUP-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-JOIN-GROUP" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-SYNC-GROUP" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-HEARTBEAT" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-LEAVE-GROUP" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-LIST-GROUPS" USING WS-REQUEST-CONTEXT, WS-REQUEST
        CALL "GROUP-COORDINATOR-ADAPTER-DESCRIBE-GROUPS" USING WS-REQUEST-CONTEXT, WS-GROUP-IDS
        CALL "GROUP-COORDINATOR-ADAPTER-DELETE-GROUPS" USING WS-REQUEST-CONTEXT, WS-GROUP-IDS, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-FETCH-ALL-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-REQUIRE-STABLE
        CALL "GROUP-COORDINATOR-ADAPTER-FETCH-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-REQUIRE-STABLE
        CALL "GROUP-COORDINATOR-ADAPTER-COMMIT-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-COMMIT-TRANSACTIONAL-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-DELETE-OFFSETS" USING WS-REQUEST-CONTEXT, WS-REQUEST, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-COMPLETE-TRANSACTION" USING WS-TP, WS-PRODUCER-ID, WS-PRODUCER-EPOCH, WS-COORDINATOR-EPOCH, WS-RESULT, WS-TIMEOUT
        CALL "GROUP-COORDINATOR-ADAPTER-GET-PARTITION-FOR" USING WS-GROUP-ID
        CALL "GROUP-COORDINATOR-ADAPTER-ON-TRANSACTION-COMPLETED" USING WS-PRODUCER-ID, WS-PARTITIONS, WS-RESULT
        CALL "GROUP-COORDINATOR-ADAPTER-ON-PARTITIONS-DELETED" USING WS-TOPIC-PARTITIONS, WS-BUFFER-SUPPLIER
        CALL "GROUP-COORDINATOR-ADAPTER-ON-ELECTION" USING WS-GROUP-METADATA-PARTITION-INDEX, WS-GROUP-METADATA-PARTITION-LEADER-EPOCH
        CALL "GROUP-COORDINATOR-ADAPTER-ON-RESIGNATION" USING WS-GROUP-METADATA-PARTITION-INDEX, WS-GROUP-METADATA-PARTITION-LEADER-EPOCH
        CALL "GROUP-COORDINATOR-ADAPTER-ON-NEW-METADATA-IMAGE" USING WS-NEW-IMAGE, WS-DELTA
        CALL "GROUP-COORDINATOR-ADAPTER-GET-GROUP-METADATA-TOPIC-CONFIGS"
        CALL "GROUP-COORDINATOR-ADAPTER-GET-GROUP-CONFIG" USING WS-GROUP-ID
        CALL "GROUP-COORDINATOR-ADAPTER-UPDATE-GROUP-CONFIG" USING WS-GROUP-ID, WS-NEW-GROUP-CONFIG
        CALL "GROUP-COORDINATOR-ADAPTER-STARTUP" USING WS-GROUP-METADATA-TOPIC-PARTITION-COUNT
        CALL "GROUP-COORDINATOR-ADAPTER-SHUTDOWN"
        CALL "GROUP-COORDINATOR-ADAPTER-CONSUMER-GROUP-DESCRIBE" USING WS-REQUEST-CONTEXT, WS-GROUP-IDS
        CALL "GROUP-COORDINATOR-ADAPTER-SHARE-GROUP-DESCRIBE" USING WS-REQUEST-CONTEXT, WS-GROUP-IDS
    END-PERFORM.

STOP RUN.