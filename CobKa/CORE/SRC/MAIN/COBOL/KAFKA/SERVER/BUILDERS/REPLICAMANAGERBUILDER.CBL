IDENTIFICATION DIVISION.
PROGRAM-ID. REPLICA-MANAGER-BUILDER.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY "KAFKA-CONFIG".
    COPY "METRICS".
    COPY "TIME".
    COPY "SCHEDULER".
    COPY "LOG-MANAGER".
    COPY "QUOTA-MANAGERS".
    COPY "METADATA-CACHE".
    COPY "LOG-DIR-FAILURE-CHANNEL".
    COPY "ALTER-PARTITION-MANAGER".
    COPY "BROKER-TOPIC-STATS".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-CONFIG PIC X(10) VALUE SPACES.
01 WS-METRICS PIC X(10) VALUE SPACES.
01 WS-TIME PIC X(10) VALUE SPACES.
01 WS-SCHEDULER PIC X(10) VALUE SPACES.
01 WS-LOG-MANAGER PIC X(10) VALUE SPACES.
01 WS-QUOTA-MANAGERS PIC X(10) VALUE SPACES.
01 WS-METADATA-CACHE PIC X(10) VALUE SPACES.
01 WS-LOG-DIR-FAILURE-CHANNEL PIC X(10) VALUE SPACES.
01 WS-ALTER-PARTITION-MANAGER PIC X(10) VALUE SPACES.
01 WS-BROKER-TOPIC-STATS PIC X(10) VALUE SPACES.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    MOVE FUNCTION NEW-KAFKA-CONFIG(SPACES) TO WS-CONFIG.
    MOVE FUNCTION NEW-METRICS(SPACES) TO WS-METRICS.
    MOVE FUNCTION NEW-TIME(SPACES) TO WS-TIME.
    MOVE FUNCTION NEW-SCHEDULER(SPACES) TO WS-SCHEDULER.
    MOVE FUNCTION NEW-LOG-MANAGER(SPACES) TO WS-LOG-MANAGER.
    MOVE FUNCTION NEW-QUOTA-MANAGERS(SPACES) TO WS-QUOTA-MANAGERS.
    MOVE FUNCTION NEW-METADATA-CACHE(SPACES) TO WS-METADATA-CACHE.
    MOVE FUNCTION NEW-LOG-DIR-FAILURE-CHANNEL(SPACES) TO WS-LOG-DIR-FAILURE-CHANNEL.
    MOVE FUNCTION NEW-ALTER-PARTITION-MANAGER(SPACES) TO WS-ALTER-PARTITION-MANAGER.
    MOVE FUNCTION NEW-BROKER-TOPIC-STATS(SPACES) TO WS-BROKER-TOPIC-STATS.

    MOVE FUNCTION NEW-REPLICA-MANAGER(WS-CONFIG,
                                     WS-METRICS,
                                     WS-TIME,
                                     WS-SCHEDULER,
                                     WS-LOG-MANAGER,
                                     SPACES,
                                     WS-QUOTA-MANAGERS,
                                     WS-METADATA-CACHE,
                                     WS-LOG-DIR-FAILURE-CHANNEL,
                                     WS-ALTER-PARTITION-MANAGER,
                                     WS-BROKER-TOPIC-STATS,
                                     FUNCTION NEW-ATOMIC-BOOLEAN(FALSE),
                                     SPACES,
                                     SPACES,
                                     SPACES,
                                     SPACES,
                                     SPACES,
                                     SPACES,
                                     SPACES,
                                     FUNCTION NEW-NEGATIVE-ONE(),
                                     SPACES,
                                     FUNCTION NEW-DIRECTORY-EVENT-HANDLER-NOOP(),
                                     FUNCTION NEW-DELAYED-ACTION-QUEUE()) TO RETURN-VALUE.
    STOP RUN.