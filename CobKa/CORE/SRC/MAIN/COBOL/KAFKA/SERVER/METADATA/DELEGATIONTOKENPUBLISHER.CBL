IDENTIFICATION DIVISION.
PROGRAM-ID. DELEGATION-TOKEN-PUBLISHER.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-FIRST-PUBLISH PIC X VALUE 'Y'.
01 WS-NODE-TYPE PIC X(20) VALUE SPACES.
01 WS-NODE-ID PIC 9(10) VALUE ZEROS.
01 WS-DELEGATION-TOKEN-DATA.
   05 WS-TOKEN-ID PIC X(20) VALUE SPACES.
   05 WS-TOKEN-INFORMATION PIC X(50) VALUE SPACES.
   05 WS-TOKEN-PRESENT PIC X VALUE 'Y'.

PROCEDURE DIVISION.
MAIN-PARAGRAPH.
    PERFORM ON-METADATA-UPDATE.
    STOP RUN.

ON-METADATA-UPDATE.
    PERFORM VARYING WS-TOKEN-ID FROM 1 BY 1 UNTIL WS-TOKEN-ID > 20
        PERFORM PROCESS-DELEGATION-TOKEN
    END-PERFORM.

PROCESS-DELEGATION-TOKEN.
    IF WS-FIRST-PUBLISH = 'Y'
        PERFORM INITIALIZE-TOKEN-CACHE
        MOVE 'N' TO WS-FIRST-PUBLISH
    ELSE
        PERFORM UPDATE-DELEGATION-TOKENS
    END-IF.

INITIALIZE-TOKEN-CACHE.
    CALL "UPDATE-TOKEN" USING WS-TOKEN-INFORMATION.

UPDATE-DELEGATION-TOKENS.
    IF WS-TOKEN-PRESENT = 'Y'
        CALL "UPDATE-TOKEN" USING WS-TOKEN-INFORMATION
    ELSE
        CALL "REMOVE-TOKEN" USING WS-TOKEN-ID
    END-IF.