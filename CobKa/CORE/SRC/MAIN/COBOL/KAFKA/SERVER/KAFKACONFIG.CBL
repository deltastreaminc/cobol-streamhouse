IDENTIFICATION DIVISION.
PROGRAM-ID. KAFKA-CONFIG.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY "AbstractKafkaConfig.cpy".
    COPY "DynamicBrokerConfig.cpy".
    COPY "GroupConfig.cpy".
    COPY "GroupCoordinatorConfig.cpy".
    COPY "ShareGroupConfig.cpy".
    COPY "ShareCoordinatorConfig.cpy".
    COPY "TransactionLogConfig.cpy".
    COPY "TransactionStateManagerConfig.cpy".
    COPY "AddPartitionsToTxnConfig.cpy".
    COPY "QuotaConfig.cpy".
    COPY "RemoteLogManagerConfig.cpy".
    COPY "QuorumConfig.cpy".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 CURRENT-CONFIG PIC X(32) VALUE SPACE.
01 PROCESS-ROLES PIC X(32) VALUE SPACE.
01 EFFECTIVE-ADVERTISED-CONTROLLER-LISTENERS.
    05 LISTENER-NAME PIC X(100) OCCURS 1 TO 32 DEPENDING ON CONTROLLER-LISTENER-NAME-COUNT.
    05 CONTROLLER-LISTENER-NAME-COUNT PIC 9(3).
01 EFFECTIVE-ADVERTISED-BROKER-LISTENERS.
    05 LISTENER-NAME PIC X(100) OCCURS 1 TO 32 DEPENDING ON BROKER-LISTENER-NAME-COUNT.
    05 BROKER-LISTENER-NAME-COUNT PIC 9(3).
01 INTER-BROKER-LISTENER-NAME PIC X(100).
01 INTER-BROKER-SECURITY-PROTOCOL PIC X(30).
01 SASL-MECHANISM-INTER-BROKER-PROTOCOL PIC X(30).
01 SASL-ENABLED-MECHANISMS.
    05 MECHANISM PIC X(30) OCCURS 1 TO 32 DEPENDING ON MECHANISM-COUNT.
    05 MECHANISM-COUNT PIC 9(3).
01 DELEGATION-TOKEN-SECRET-KEY PIC X(100).
01 CONFIGURABLES.
    05 RECONFIGURABLE PIC X(64) OCCURS 1 TO 32 DEPENDING ON RECONFIGURABLE-COUNT.
    05 RECONFIGURABLE-COUNT PIC 9(3).

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    MOVE "this" TO CURRENT-CONFIG.
    PERFORM PARSE-PROCESS-ROLES.
    PERFORM INIT-DYNAMIC-CONFIG.
    PERFORM INIT-REMOTE-LOG-MANAGER-CONFIG.
    PERFORM INIT-QUORUM-CONFIG.
    PERFORM INIT-GROUP-COORDINATOR-CONFIG.
    PERFORM INIT-SHARE-GROUP-CONFIG.
    PERFORM INIT-SHARE-COORDINATOR-CONFIG.
    PERFORM INIT-TRANSACTION-CONFIG.
    PERFORM INIT-QUOTA-CONFIG.
    PERFORM INIT-GENERAL-CONFIG.
    PERFORM INIT-METADATA-CONFIG.
    PERFORM INIT-AUTHORIZER-CONFIG.
    PERFORM INIT-SOCKET-SERVER-CONFIG.
    PERFORM INIT-RACK-CONFIG.
    PERFORM INIT-LOG-CONFIG.
    PERFORM INIT-REPLICATION-CONFIG.
    PERFORM INIT-CONTROLLED-SHUTDOWN-CONFIG.
    PERFORM INIT-NEW-GROUP-COORDINATOR-CONFIG.
    PERFORM INIT-METRIC-CONFIG.
    PERFORM INIT-CLIENT-TELEMETRY-METRICS-CONFIG.
    PERFORM INIT-SSL-SASL-CONFIG.
    PERFORM INIT-DELEGATION-TOKEN-CONFIG.
    PERFORM INIT-FETCH-CONFIG.
    PERFORM INIT-REQUEST-LIMIT-CONFIG.
    PERFORM VALIDATE-CONFIG.
    STOP RUN.

PARSE-PROCESS-ROLES.
    MOVE SPACE TO PROCESS-ROLES.
    INSPECT FUNCTION TRIM(KRaftConfigs.PROCESS_ROLES_CONFIG) TALLYING FOR REPLACING ALL "," BY " ".
    MOVE FUNCTION TRIM(KRaftConfigs.PROCESS_ROLES_CONFIG) TO PROCESS-ROLES.

INIT-DYNAMIC-CONFIG.
    PERFORM CREATE-DYNAMIC-BROKER-CONFIG.

INIT-REMOTE-LOG-MANAGER-CONFIG.
    MOVE NEW RemoteLogManagerConfig(CURRENT-CONFIG) TO _remoteLogManagerConfig.

INIT-QUORUM-CONFIG.
    MOVE NEW QuorumConfig(CURRENT-CONFIG) TO _quorumConfig.

INIT-GROUP-COORDINATOR-CONFIG.
    MOVE NEW GroupCoordinatorConfig(CURRENT-CONFIG) TO _groupCoordinatorConfig.

INIT-SHARE-GROUP-CONFIG.
    MOVE NEW ShareGroupConfig(CURRENT-CONFIG) TO _shareGroupConfig.

INIT-SHARE-COORDINATOR-CONFIG.
    MOVE NEW ShareCoordinatorConfig(CURRENT-CONFIG) TO _shareCoordinatorConfig.

INIT-TRANSACTION-CONFIG.
    MOVE NEW TransactionLogConfig(CURRENT-CONFIG) TO _transactionLogConfig.
    MOVE NEW TransactionStateManagerConfig(CURRENT-CONFIG) TO _transactionStateManagerConfig.
    MOVE NEW AddPartitionsToTxnConfig(CURRENT-CONFIG) TO _addPartitionsToTxnConfig.

INIT-QUOTA-CONFIG.
    MOVE NEW QuotaConfig(CURRENT-CONFIG) TO _quotaConfig.

INIT-GENERAL-CONFIG.
    MOVE FUNCTION GETINT(ServerConfigs.BROKER_ID_CONFIG) TO BROKER-ID.
    MOVE FUNCTION GETINT(KRaftConfigs.NODE_ID_CONFIG) TO NODE-ID.
    MOVE FUNCTION GETINT(KRaftConfigs.INITIAL_BROKER_REGISTRATION_TIMEOUT_MS_CONFIG) TO INITIAL-REGISTRATION-TIMEOUT-MS.
    MOVE FUNCTION GETINT(KRaftConfigs.BROKER_HEARTBEAT_INTERVAL_MS_CONFIG) TO BROKER-HEARTBEAT-INTERVAL-MS.
    MOVE FUNCTION GETINT(KRaftConfigs.BROKER_SESSION_TIMEOUT_MS_CONFIG) TO BROKER-SESSION-TIMEOUT-MS.
    MOVE FUNCTION GETLONG(KRaftConfigs.CONTROLLER_PERFORMANCE_SAMPLE_PERIOD_MS) TO CONTROLLER-PERFORMANCE-SAMPLE-PERIOD-MS.
    MOVE FUNCTION GETLONG(KRaftConfigs.CONTROLLER_PERFORMANCE_ALWAYS_LOG_THRESHOLD_MS) TO CONTROLLER-PERFORMANCE-ALWAYS-LOG-THRESHOLD-MS.

INIT-METADATA-CONFIG.
    MOVE FUNCTION GETLONG(KRaftConfigs.METADATA_SNAPSHOT_MAX_NEW_RECORD_BYTES_CONFIG) TO METADATA-SNAPSHOT-MAX-NEW-RECORD-BYTES.
    MOVE FUNCTION GETLONG(KRaftConfigs.METADATA_SNAPSHOT_MAX_INTERVAL_MS_CONFIG) TO METADATA-SNAPSHOT-MAX-INTERVAL-MS.
    MOVE FUNCTION GETINT(KRaftConfigs.METADATA_MAX_IDLE_INTERVAL_MS_CONFIG) TO METADATA-MAX-IDLE-INTERVAL-MS.

INIT-AUTHORIZER-CONFIG.
    PERFORM CREATE-AUTHORIZER.

INIT-SOCKET-SERVER-CONFIG.
    MOVE FUNCTION GETINT(SocketServerConfigs.SOCKET_SEND_BUFFER_BYTES_CONFIG) TO SOCKET-SEND-BUFFER-BYTES.
    MOVE FUNCTION GETINT(SocketServerConfigs.SOCKET_RECEIVE_BUFFER_BYTES_CONFIG) TO SOCKET-RECEIVE-BUFFER-BYTES.
    MOVE FUNCTION GETINT(SocketServerConfigs.SOCKET_REQUEST_MAX_BYTES_CONFIG) TO SOCKET-REQUEST-MAX-BYTES.
    MOVE FUNCTION GETINT(SocketServerConfigs.SOCKET_LISTEN_BACKLOG_SIZE_CONFIG) TO SOCKET-LISTEN-BACKLOG-SIZE.
    MOVE FUNCTION GETINT(SocketServerConfigs.MAX_CONNECTIONS_PER_IP_CONFIG) TO MAX-CONNECTIONS-PER-IP.
    PERFORM INIT-MAX-CONNECTIONS-PER-IP-OVERRIDES.
    MOVE FUNCTION GETINT(SocketServerConfigs.MAX_CONNECTIONS_CONFIG) TO MAX-CONNECTIONS.
    MOVE FUNCTION GETINT(SocketServerConfigs.MAX_CONNECTION_CREATION_RATE_CONFIG) TO MAX-CONNECTION-CREATION-RATE.
    MOVE FUNCTION GETLONG(SocketServerConfigs.CONNECTIONS_MAX_IDLE_MS_CONFIG) TO CONNECTIONS-MAX-IDLE-MS.
    MOVE FUNCTION GETINT(SocketServerConfigs.FAILED_AUTHENTICATION_DELAY_MS_CONFIG) TO FAILED-AUTHENTICATION-DELAY-MS.
    MOVE FUNCTION GETINT(SocketServerConfigs.QUEUED_MAX_REQUESTS_CONFIG) TO QUEUED-MAX-REQUESTS.
    MOVE FUNCTION GETLONG(SocketServerConfigs.QUEUED_MAX_BYTES_CONFIG) TO QUEUED-MAX-BYTES.
    MOVE FUNCTION GETINT(SocketServerConfigs.NUM_NETWORK_THREADS_CONFIG) TO NUM-NETWORK-THREADS.

INIT-RACK-CONFIG.
    MOVE FUNCTION GETSTRING(ServerConfigs.BROKER_RACK_CONFIG) TO RACK.
    MOVE FUNCTION GETSTRING(ReplicationConfigs.REPLICA_SELECTOR_CLASS_CONFIG) TO REPLICA-SELECTOR-CLASS-NAME.

INIT-LOG-CONFIG.
    MOVE FUNCTION GETBOOLEAN(ServerLogConfigs.AUTO_CREATE_TOPICS_ENABLE_CONFIG) TO AUTO-CREATE-TOPICS-ENABLE.
    MOVE FUNCTION GETINT(ServerLogConfigs.NUM_PARTITIONS_CONFIG) TO NUM-PARTITIONS.
    MOVE FUNCTION GETSTRING(ServerLogConfigs.LOG_DIRS_CONFIG) TO LOG-DIRS.
    MOVE FUNCTION GETINT(ServerLogConfigs.LOG_SEGMENT_BYTES_CONFIG) TO LOG-SEGMENT-BYTES.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_FLUSH_INTERVAL_MESSAGES_CONFIG) TO LOG-FLUSH-INTERVAL-MESSAGES.
    MOVE FUNCTION GETINT(CleanerConfig.LOG_CLEANER_THREADS_PROP) TO LOG-CLEANER-THREADS.
    MOVE FUNCTION GETINT(ServerLogConfigs.NUM_RECOVERY_THREADS_PER_DATA_DIR_CONFIG) TO NUM-RECOVERY-THREADS-PER-DATA-DIR.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_FLUSH_SCHEDULER_INTERVAL_MS_CONFIG) TO LOG-FLUSH-SCHEDULER-INTERVAL-MS.
    MOVE FUNCTION GETINT(ServerLogConfigs.LOG_FLUSH_OFFSET_CHECKPOINT_INTERVAL_MS_CONFIG) TO LOG-FLUSH-OFFSET-CHECKPOINT-INTERVAL-MS.
    MOVE FUNCTION GETINT(ServerLogConfigs.LOG_FLUSH_START_OFFSET_CHECKPOINT_INTERVAL_MS_CONFIG) TO LOG-FLUSH-START-OFFSET-CHECKPOINT-INTERVAL-MS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_CLEANUP_INTERVAL_MS_CONFIG) TO LOG-CLEANUP-INTERVAL-MS.
    MOVE FUNCTION GETLIST(ServerLogConfigs.LOG_CLEANUP_POLICY_CONFIG) TO LOG-CLEANUP-POLICY.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_RETENTION_BYTES_CONFIG) TO LOG-RETENTION-BYTES.
    MOVE FUNCTION GETLONG(CleanerConfig.LOG_CLEANER_DEDUPE_BUFFER_SIZE_PROP) TO LOG-CLEANER-DEDUPE-BUFFER-SIZE.
    MOVE FUNCTION GETDOUBLE(CleanerConfig.LOG_CLEANER_DEDUPE_BUFFER_LOAD_FACTOR_PROP) TO LOG-CLEANER-DEDUPE-BUFFER-LOAD-FACTOR.
    MOVE FUNCTION GETINT(CleanerConfig.LOG_CLEANER_IO_BUFFER_SIZE_PROP) TO LOG-CLEANER-IO-BUFFER-SIZE.
    MOVE FUNCTION GETDOUBLE(CleanerConfig.LOG_CLEANER_IO_MAX_BYTES_PER_SECOND_PROP) TO LOG-CLEANER-IO-MAX-BYTES-PER-SECOND.
    MOVE FUNCTION GETLONG(CleanerConfig.LOG_CLEANER_DELETE_RETENTION_MS_PROP) TO LOG-CLEANER-DELETE-RETENTION-MS.
    MOVE FUNCTION GETLONG(CleanerConfig.LOG_CLEANER_MIN_COMPACTION_LAG_MS_PROP) TO LOG-CLEANER-MIN-COMPACTION-LAG-MS.
    MOVE FUNCTION GETLONG(CleanerConfig.LOG_CLEANER_MAX_COMPACTION_LAG_MS_PROP) TO LOG-CLEANER-MAX-COMPACTION-LAG-MS.
    MOVE FUNCTION GETLONG(CleanerConfig.LOG_CLEANER_BACKOFF_MS_PROP) TO LOG-CLEANER-BACKOFF-MS.
    MOVE FUNCTION GETDOUBLE(CleanerConfig.LOG_CLEANER_MIN_CLEAN_RATIO_PROP) TO LOG-CLEANER-MIN-CLEAN-RATIO.
    MOVE FUNCTION GETBOOLEAN(CleanerConfig.LOG_CLEANER_ENABLE_PROP) TO LOG-CLEANER-ENABLE.
    MOVE FUNCTION GETINT(ServerLogConfigs.LOG_INDEX_SIZE_MAX_BYTES_CONFIG) TO LOG-INDEX-SIZE-MAX-BYTES.
    MOVE FUNCTION GETINT(ServerLogConfigs.LOG_INDEX_INTERVAL_BYTES_CONFIG) TO LOG-INDEX-INTERVAL-BYTES.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_DELETE_DELAY_MS_CONFIG) TO LOG-DELETE-DELAY-MS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_ROLL_TIME_MILLIS_CONFIG) TO LOG-ROLL-TIME-MILLIS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_ROLL_TIME_JITTER_MILLIS_CONFIG) TO LOG-ROLL-TIME-JITTER-MILLIS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_FLUSH_INTERVAL_MS_CONFIG) TO LOG-FLUSH-INTERVAL-MS.
    MOVE FUNCTION GETINT(ServerLogConfigs.MIN_IN_SYNC_REPLICAS_CONFIG) TO MIN-IN-SYNC-REPLICAS.
    MOVE FUNCTION GETBOOLEAN(ServerLogConfigs.LOG_PRE_ALLOCATE_CONFIG) TO LOG-PRE-ALLOCATE-ENABLE.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_INITIAL_TASK_DELAY_MS_CONFIG) TO LOG-INITIAL-TASK-DELAY-MS.
    PERFORM INIT-LOG-MESSAGE-TIMESTAMP-TYPE.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_MESSAGE_TIMESTAMP_BEFORE_MAX_MS_CONFIG) TO LOG-MESSAGE-TIMESTAMP-BEFORE-MAX-MS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_MESSAGE_TIMESTAMP_AFTER_MAX_MS_CONFIG) TO LOG-MESSAGE-TIMESTAMP-AFTER-MAX-MS.
    MOVE FUNCTION GETLONG(ServerLogConfigs.LOG_DIR_FAILURE_TIMEOUT_MS_CONFIG) TO LOG-DIR-FAILURE-TIMEOUT-MS.

INIT-REPLICATION-CONFIG.
    MOVE FUNCTION GETINT(ReplicationConfigs.CONTROLLER_SOCKET_TIMEOUT_MS_CONFIG) TO CONTROLLER-SOCKET-TIMEOUT-MS.
    MOVE FUNCTION GETINT(ReplicationConfigs.DEFAULT_REPLICATION_FACTOR_CONFIG) TO DEFAULT-REPLICATION-FACTOR.
    MOVE FUNCTION GETLONG(ReplicationConfigs.REPLICA_LAG_TIME_MAX_MS_CONFIG) TO REPLICA-LAG-TIME-MAX-MS.
    MOVE FUNCTION GETINT(ReplicationConfigs.REPLICA_SOCKET_TIMEOUT_MS_CONFIG) TO REPLICA-SOCKET-TIMEOUT-MS.
    MOVE FUNCTION GETINT(ReplicationConfigs.REPLICA_SOCKET_RECEIVE_BUFFER_BYTES_CONFIG) TO