IDENTIFICATION DIVISION.
PROGRAM-ID. CONTROLLER-CONFIGURATION-VALIDATOR.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY CLIENTMETRICS-CONFIGS.
    COPY GROUPCOORDINATOR-CONFIG.
    COPY KAFKACONFIG.
    COPY LOGCONFIG.
    COPY TOPIC.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-VALIDATE-TOPIC-NAME.
   03 WS-TOPIC-NAME PIC X(100).
01 WS-VALIDATE-BROKER-NAME.
   03 WS-BROKER-NAME PIC X(100).
01 WS-VALIDATE-GROUP-NAME.
   03 WS-GROUP-NAME PIC X(100).
01 WS-PROPERTIES.
   03 WS-PROPERTY-KEY PIC X(100).
   03 WS-PROPERTY-VALUE PIC X(100).
01 WS-NULL-TOPIC-CONFIGS.
   03 WS-NULL-TOPIC-CONFIG-ITEM PIC X(100)
      OCCURS 1 TO 99 TIMES DEPENDING ON WS-NULL-TOPIC-CONFIGS-COUNT.
   03 WS-NULL-TOPIC-CONFIGS-COUNT PIC 9(2) COMP.
01 WS-NULL-GROUP-CONFIGS.
   03 WS-NULL-GROUP-CONFIG-ITEM PIC X(100)
      OCCURS 1 TO 99 TIMES DEPENDING ON WS-NULL-GROUP-CONFIGS-COUNT.
   03 WS-NULL-GROUP-CONFIGS-COUNT PIC 9(2) COMP.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    PERFORM VALIDATE-TOPIC-NAME
    PERFORM VALIDATE-BROKER-NAME
    PERFORM VALIDATE-GROUP-NAME
    PERFORM THROW-EXCEPTION-FOR-UNKNOWN-RESOURCE-TYPE.

VALIDATE-TOPIC-NAME.
    IF WS-TOPIC-NAME IS EQUAL TO SPACES
        RAISE INVALID-REQUEST-EXCEPTION "Default topic resources are not allowed."
    CALL "TOPIC-VALIDATE" USING WS-TOPIC-NAME.

VALIDATE-BROKER-NAME.
    IF WS-BROKER-NAME IS NOT EQUAL TO SPACES
        MOVE FUNCTION INTEGER-OF-CHAR(WS-BROKER-NAME) TO WS-BROKER-ID
        IF WS-BROKER-ID IS LESS THAN 0
            RAISE INVALID-REQUEST-EXCEPTION "Invalid negative broker ID."
    ELSE
        RAISE INVALID-REQUEST-EXCEPTION "Unable to parse broker name as a base 10 number.".

VALIDATE-GROUP-NAME.
    IF WS-GROUP-NAME IS EQUAL TO SPACES
        RAISE INVALID-REQUEST-EXCEPTION "Default group resources are not allowed.".

THROW-EXCEPTION-FOR-UNKNOWN-RESOURCE-TYPE.
    RAISE INVALID-REQUEST-EXCEPTION "Unknown resource type".

VALIDATE.
    EVALUATE RESOURCE-TYPE
        WHEN TOPIC
            PERFORM VALIDATE-TOPIC-NAME
        WHEN BROKER
            PERFORM VALIDATE-BROKER-NAME
        WHEN OTHER
            PERFORM THROW-EXCEPTION-FOR-UNKNOWN-RESOURCE-TYPE
    END-EVALUATE.

VALIDATE.
    EVALUATE RESOURCE-TYPE
        WHEN TOPIC
            PERFORM VALIDATE-TOPIC-NAME
            PERFORM VALIDATE-TOPIC-CONFIGS
        WHEN BROKER
            PERFORM VALIDATE-BROKER-NAME
        WHEN CLIENT-METRICS
            PERFORM VALIDATE-CLIENT-METRICS-CONFIGS
        WHEN GROUP
            PERFORM VALIDATE-GROUP-NAME
            PERFORM VALIDATE-GROUP-CONFIGS
        WHEN OTHER
            PERFORM THROW-EXCEPTION-FOR-UNKNOWN-RESOURCE-TYPE
    END-EVALUATE.

VALIDATE-TOPIC-CONFIGS.
    MOVE ZERO TO WS-NULL-TOPIC-CONFIGS-COUNT.
    PERFORM VARYING WS-PROPERTY-KEY THROUGH WS-PROPERTIES
        IF WS-PROPERTY-VALUE IS EQUAL TO SPACES
            ADD 1 TO WS-NULL-TOPIC-CONFIGS-COUNT
            MOVE WS-PROPERTY-KEY TO WS-NULL-TOPIC-CONFIG-ITEM(WS-NULL-TOPIC-CONFIGS-COUNT)
        ELSE
            CALL "LOGCONFIG-VALIDATE" USING OLD-CONFIGS, WS-PROPERTIES, KAFKACONFIG-EXTRACT-LOGCONFIG-MAP, KAFKACONFIG-REMOTELOGMANAGER-CONFIG-ISENABLEREMODESTORAGE
    END-PERFORM.
    IF WS-NULL-TOPIC-CONFIGS-COUNT IS GREATER THAN ZERO
        RAISE INVALID-CONFIGURATION-EXCEPTION "Null value not supported for topic configs: " WS-NULL-TOPIC-CONFIG-ITEM.

VALIDATE-CLIENT-METRICS-CONFIGS.
    MOVE ZERO TO WS-NULL-TOPIC-CONFIGS-COUNT.
    PERFORM VARYING WS-PROPERTY-KEY THROUGH WS-PROPERTIES
        CALL "CLIENTMETRICS-CONFIGS-VALIDATE" USING RESOURCE-NAME, WS-PROPERTIES
    END-PERFORM.

VALIDATE-GROUP-CONFIGS.
    MOVE ZERO TO WS-NULL-GROUP-CONFIGS-COUNT.
    PERFORM VARYING WS-PROPERTY-KEY THROUGH WS-PROPERTIES
        IF WS-PROPERTY-VALUE IS EQUAL TO SPACES
            ADD 1 TO WS-NULL-GROUP-CONFIGS-COUNT
            MOVE WS-PROPERTY-KEY TO WS-NULL-GROUP-CONFIG-ITEM(WS-NULL-GROUP-CONFIGS-COUNT)
        ELSE
            CALL "GROUPCOORDINATOR-VALIDATE" USING WS-PROPERTIES, KAFKACONFIG-GROUPCOORDINATOR-CONFIG, KAFKACONFIG-SHAREGROUP-CONFIG
    END-PERFORM.
    IF WS-NULL-GROUP-CONFIGS-COUNT IS GREATER THAN ZERO
        RAISE INVALID-CONFIGURATION-EXCEPTION "Null value not supported for group configs: " WS-NULL-GROUP-CONFIG-ITEM.