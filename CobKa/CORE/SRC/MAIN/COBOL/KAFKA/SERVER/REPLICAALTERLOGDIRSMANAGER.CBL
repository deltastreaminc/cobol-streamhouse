IDENTIFICATION DIVISION.
PROGRAM-ID. REPLICAALTERLLOGDIRSMANAGER.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY "KAFKACONFIG".
    COPY "REPLICAMANAGER".
    COPY "REPLICATIONQUOTAMANAGER".
    COPY "BROKERTOPICSTATS".
    COPY "DIRECTORYEVENTHANDLER".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 BROKERCONFIG PIC X(10).
01 REPLICAMANAGER PIC X(10).
01 QUOTAMANAGER PIC X(10).
01 BROKERTOPICSTATS PIC X(10).
01 DIRECTORYEVENTHANDLER PIC X(10).
01 THREADNAME PIC X(20).
01 LEADER PIC X(10).
01 FAILEDPARTITIONS PIC X(10).
01 REPLICAFETCHBACKOFFMS PIC 9(5).

PROCEDURE DIVISION.

CRETEFETCHERTHREAD.
    MOVE "ReplicaAlterLogDirsThread-" TO THREADNAME.
    MOVE "LocalLeaderEndPoint" TO LEADER.
    CREATE REPLICAALTERLLOGDIRSTHREAD USING THREADNAME, LEADER, FAILEDPARTITIONS,
                                       REPLICAMANAGER, QUOTAMANAGER, BROKERTOPICSTATS, 
                                       REPLICAFETCHBACKOFFMS, DIRECTORYEVENTHANDLER.

ADDPARTITIONSTODFETCHERTHREAD.
    MOVE INITIALOFFSETANDEPOCHS TO FETCHERTHREAD.
    PERFORM VARYING TP IN INITIALOFFSETANDEPOCHS
        IF TP IN ADDEDPARTITIONS
            MOVE TP TO ADDEDINITIALOFFSETS
        ELSE
            MOVE TP TO NOTADDEDINITIALOFFSETS
    END-PERFORM.
    IF ADDEDINITIALOFFSETS IS NOT EMPTY
        DISPLAY "Added log dir fetcher for partitions with initial offsets " ADDEDINITIALOFFSETS
    END-IF.
    IF NOTADDEDINITIALOFFSETS IS NOT EMPTY
        DISPLAY "Failed to add log dir fetch for partitions " NOTADDEDINITIALOFFSETS 
                 " since the log dir reassignment has already completed"
    END-IF.

SHUTDOWN.
    DISPLAY "shutting down".
    CALL "CLOSEMALLFETCHERS".
    DISPLAY "shutdown completed".