IDENTIFICATION DIVISION.
PROGRAM-ID. NETWORK-UTILS.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-PREFIX PIC X(16).
01 WS-CONFIG PIC X(256).
01 WS-METRICS PIC X(256).
01 WS-TIME PIC X(256).
01 WS-LOG-CONTEXT PIC X(256).
01 WS-CHANNEL-BUILDER PIC X(256).
01 WS-METRIC-GROUP-PREFIX PIC X(32).
01 WS-SELECTOR PIC X(256).
01 WS-CLIENT-ID PIC X(32).
01 WS-NETWORK-CLIENT PIC X(256).

PROCEDURE DIVISION.
BUILD-NETWORK-CLIENT.
    MOVE FUNCTION CONCATENATE(WS-PREFIX, "-channel") TO WS-METRIC-GROUP-PREFIX.
    CALL "CHANNEL-BUILDERS-CLIENT-CHANNEL-BUILDER" USING
        WS-CONFIG(1:32)
        "SERVER"
        WS-CONFIG
        WS-CONFIG(1:32)
        WS-CONFIG(1:32)
        WS-TIME
        WS-LOG-CONTEXT
        RETURNING WS-CHANNEL-BUILDER.
    IF WS-CHANNEL-BUILDER IS INSTANCE OF "RECONFIGURABLE" THEN
        CALL "CONFIG-ADD-RECONFIGURABLE" USING WS-CONFIG, WS-CHANNEL-BUILDER
    END-IF.
    CALL "SELECTOR-CREATE" USING
        FUNCTION LENGTH("UNLIMITED")
        WS-CONFIG(1:32)
        WS-METRICS
        WS-TIME
        WS-METRIC-GROUP-PREFIX
        FUNCTION LENGTH("EMPTY-MAP")
        FUNCTION LENGTH("FALSE")
        WS-CHANNEL-BUILDER
        WS-LOG-CONTEXT
        RETURNING WS-SELECTOR.
    MOVE FUNCTION CONCATENATE(WS-PREFIX, "-client-", WS-CONFIG(1:32)) TO WS-CLIENT-ID.
    CALL "NETWORK-CLIENT-CREATE" USING
        WS-SELECTOR
        WS-METRICS
        WS-CLIENT-ID
        FUNCTION LENGTH("1")
        FUNCTION LENGTH("50")
        FUNCTION LENGTH("50")
        FUNCTION LENGTH("USE-DEFAULT-BUFFER-SIZE")
        WS-CONFIG(1:32)
        WS-CONFIG(1:32)
        WS-CONFIG(1:32)
        WS-CONFIG(1:32)
        WS-TIME
        FUNCTION LENGTH("TRUE")
        WS-CONFIG
        WS-LOG-CONTEXT
        FUNCTION LENGTH("NONE")
        RETURNING WS-NETWORK-CLIENT.
    MOVE WS-NETWORK-CLIENT TO RETURN-CODE.

STOP RUN.