IDENTIFICATION DIVISION.
PROGRAM-ID. CONFIG-HELPER.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY "KAFKA-NETWORK-REQUEST-CHANNEL.cpy".
    COPY "KAFKA-UTILS-LOGGING-CONTROLLER.cpy".
    COPY "KAFKA-UTILS-LOGGING.cpy".
    COPY "KAFKA-COMMON-ACL-OPERATION.cpy".
    COPY "KAFKA-COMMON-CONFIG.cpy".
    COPY "KAFKA-COMMON-ERRORS.cpy".
    COPY "KAFKA-COMMON-INTERNALS-TOPIC.cpy".
    COPY "KAFKA-COMMON-MESSAGE-DESCRIBE-CONFIGS-REQUEST-DATA.cpy".
    COPY "KAFKA-COMMON-MESSAGE-DESCRIBE-CONFIGS-RESPONSE-DATA.cpy".
    COPY "KAFKA-COMMON-PROTOCOL.cpy".
    COPY "KAFKA-COMMON-REQUESTS.cpy".
    COPY "KAFKA-COMMON-RESOURCE.cpy".
    COPY "KAFKA-COORDINATOR-GROUP-GROUP-CONFIG.cpy".
    COPY "KAFKA-METADATA-CACHE.cpy".
    COPY "KAFKA-SERVER-CONFIG.cpy".
    COPY "KAFKA-SERVER-CONFIG-SYNONYMS.cpy".
    COPY "KAFKA-STORAGE-INTERNALS-LOG-LOG-CONFIG.cpy".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-CONFIG-ENTRIES PIC X(32) OCCURS 0 TO 32767 TIMES DEPENDING ON WS-CONFIG-ENTRIES-COUNT.
01 WS-CONFIG-ENTRIES-COUNT PIC 9(5) COMP.
01 WS-AUTHORIZED-RESOURCES PIC X(32) OCCURS 0 TO 32767 TIMES DEPENDING ON WS-AUTHORIZED-RESOURCES-COUNT.
01 WS-AUTHORIZED-RESOURCES-COUNT PIC 9(5) COMP.
01 WS-UNAUTHORIZED-RESOURCES PIC X(32) OCCURS 0 TO 32767 TIMES DEPENDING ON WS-UNAUTHORIZED-RESOURCES-COUNT.
01 WS-UNAUTHORIZED-RESOURCES-COUNT PIC 9(5) COMP.

PROCEDURE DIVISION.

    MOVE FUNCTION ALL-ZEROES TO WS-CONFIG-ENTRIES, WS-AUTHORIZED-RESOURCES, WS-UNAUTHORIZED-RESOURCES.
    MOVE 0 TO WS-CONFIG-ENTRIES-COUNT, WS-AUTHORIZED-RESOURCES-COUNT, WS-UNAUTHORIZED-RESOURCES-COUNT.

    PERFORM HANDLE-DESCRIBE-CONFIGS-REQUEST.

    STOP RUN.

HANDLE-DESCRIBE-CONFIGS-REQUEST.
    MOVE REQUEST-CHANNEL-REQUEST TO WS-DESCRIBE-CONFIGS-REQUEST.
    PERFORM DESCRIBE-CONFIGS.
    MOVE WS-DESCRIBE-CONFIGS-RESPONSE-DATA TO RETURN-CODE.

DESCRIBE-CONFIGS.
    PERFORM PARTITION-RESOURCES.
    PERFORM DESCRIBE-AUTHORIZED-CONFIGS.
    PERFORM DESCRIBE-UNAUTHORIZED-CONFIGS.
    MOVE WS-AUTHORIZED-CONFIGS TO WS-DESCRIBE-CONFIGS-RESPONSE-DATA-RESULTS.
    MOVE WS-UNAUTHORIZED-CONFIGS TO WS-DESCRIBE-CONFIGS-RESPONSE-DATA-RESULTS.

PARTITION-RESOURCES.
    MOVE FUNCTION ALL-ZEROES TO WS-AUTHORIZED-RESOURCES, WS-UNAUTHORIZED-RESOURCES.
    MOVE 0 TO WS-AUTHORIZED-RESOURCES-COUNT, WS-UNAUTHORIZED-RESOURCES-COUNT.
    PERFORM VARYING I FROM 1 BY 1 UNTIL I > WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-COUNT
        EVALUATE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-TYPE(I)
        WHEN CONFIG-RESOURCE-TYPE-BROKER OR CONFIG-RESOURCE-TYPE-BROKER-LOGGER OR CONFIG-RESOURCE-TYPE-CLIENT-METRICS
            IF AUTH-HELPER-AUTHORIZE(REQUEST-CONTEXT, DESCRIBE-CONFIGS, CLUSTER, CLUSTER-NAME)
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-AUTHORIZED-RESOURCES(WS-AUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-AUTHORIZED-RESOURCES-COUNT
            ELSE
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-UNAUTHORIZED-RESOURCES(WS-UNAUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-UNAUTHORIZED-RESOURCES-COUNT
            END-IF
        WHEN CONFIG-RESOURCE-TYPE-TOPIC
            IF AUTH-HELPER-AUTHORIZE(REQUEST-CONTEXT, DESCRIBE-CONFIGS, TOPIC, WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-NAME(I))
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-AUTHORIZED-RESOURCES(WS-AUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-AUTHORIZED-RESOURCES-COUNT
            ELSE
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-UNAUTHORIZED-RESOURCES(WS-UNAUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-UNAUTHORIZED-RESOURCES-COUNT
            END-IF
        WHEN CONFIG-RESOURCE-TYPE-GROUP
            IF AUTH-HELPER-AUTHORIZE(REQUEST-CONTEXT, DESCRIBE-CONFIGS, GROUP, WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-NAME(I))
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-AUTHORIZED-RESOURCES(WS-AUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-AUTHORIZED-RESOURCES-COUNT
            ELSE
                MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES(I) TO WS-UNAUTHORIZED-RESOURCES(WS-UNAUTHORIZED-RESOURCES-COUNT)
                ADD 1 TO WS-UNAUTHORIZED-RESOURCES-COUNT
            END-IF
        WHEN OTHER
            RAISE INVALID-REQUEST-EXCEPTION
        END-EVALUATE
    END-PERFORM.

DESCRIBE-AUTHORIZED-CONFIGS.
    MOVE FUNCTION ALL-ZEROES TO WS-AUTHORIZED-CONFIGS.
    MOVE 0 TO WS-AUTHORIZED-CONFIGS-COUNT.
    PERFORM VARYING I FROM 1 BY 1 UNTIL I > WS-AUTHORIZED-RESOURCES-COUNT
        PERFORM DESCRIBE-CONFIG USING WS-AUTHORIZED-RESOURCES(I), WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
        MOVE WS-DESCRIBE-CONFIGS-RESULT TO WS-AUTHORIZED-CONFIGS(WS-AUTHORIZED-CONFIGS-COUNT)
        ADD 1 TO WS-AUTHORIZED-CONFIGS-COUNT
    END-PERFORM.

DESCRIBE-UNAUTHORIZED-CONFIGS.
    MOVE FUNCTION ALL-ZEROES TO WS-UNAUTHORIZED-CONFIGS.
    MOVE 0 TO WS-UNAUTHORIZED-CONFIGS-COUNT.
    PERFORM VARYING I FROM 1 BY 1 UNTIL I > WS-UNAUTHORIZED-RESOURCES-COUNT
        EVALUATE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-TYPE(I)
        WHEN CONFIG-RESOURCE-TYPE-BROKER OR CONFIG-RESOURCE-TYPE-BROKER-LOGGER OR CONFIG-RESOURCE-TYPE-CLIENT-METRICS
            MOVE CLUSTER-AUTHORIZATION-FAILED TO WS-DESCRIBE-CONFIGS-RESULT-ERROR-CODE
        WHEN CONFIG-RESOURCE-TYPE-TOPIC
            MOVE TOPIC-AUTHORIZATION-FAILED TO WS-DESCRIBE-CONFIGS-RESULT-ERROR-CODE
        WHEN CONFIG-RESOURCE-TYPE-GROUP
            MOVE GROUP-AUTHORIZATION-FAILED TO WS-DESCRIBE-CONFIGS-RESULT-ERROR-CODE
        WHEN OTHER
            RAISE INVALID-REQUEST-EXCEPTION
        END-EVALUATE
        MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-NAME(I) TO WS-DESCRIBE-CONFIGS-RESULT-RESOURCE-NAME
        MOVE WS-DESCRIBE-CONFIGS-REQUEST-RESOURCES-TYPE(I) TO WS-DESCRIBE-CONFIGS-RESULT-RESOURCE-TYPE
        MOVE WS-DESCRIBE-CONFIGS-RESULT TO WS-UNAUTHORIZED-CONFIGS(WS-UNAUTHORIZED-CONFIGS-COUNT)
        ADD 1 TO WS-UNAUTHORIZED-CONFIGS-COUNT
    END-PERFORM.

DESCRIBE-CONFIG.
    EVALUATE WS-DESCRIBE-CONFIGS-RESOURCE-TYPE
    WHEN CONFIG-RESOURCE-TYPE-TOPIC
        PERFORM DESCRIBE-TOPIC-CONFIG
    WHEN CONFIG-RESOURCE-TYPE-BROKER
        PERFORM DESCRIBE-BROKER-CONFIG
    WHEN CONFIG-RESOURCE-TYPE-BROKER-LOGGER
        PERFORM DESCRIBE-BROKER-LOGGER-CONFIG
    WHEN CONFIG-RESOURCE-TYPE-CLIENT-METRICS
        PERFORM DESCRIBE-CLIENT-METRICS-CONFIG
    WHEN CONFIG-RESOURCE-TYPE-GROUP
        PERFORM DESCRIBE-GROUP-CONFIG
    WHEN OTHER
        RAISE INVALID-REQUEST-EXCEPTION
    END-EVALUATE.

DESCRIBE-TOPIC-CONFIG.
    PERFORM VALIDATE-TOPIC.
    IF METADATA-CACHE-CONTAINS(WS-DESCRIBE-CONFIGS-RESOURCE-NAME)
        MOVE CONFIG-REPOSITORY-TOPIC-CONFIG(WS-DESCRIBE-CONFIGS-RESOURCE-NAME) TO WS-TOPIC-PROPS
        MOVE LOG-CONFIG-FROM-PROPS(CONFIG-EXTRACT-LOG-CONFIG-MAP, WS-TOPIC-PROPS) TO WS-LOG-CONFIG
        PERFORM CREATE-RESPONSE-CONFIG USING WS-LOG-CONFIG, WS-TOPIC-PROPS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
    ELSE
        MOVE UNKNOWN-TOPIC-OR-PARTITION-ERROR-CODE TO WS-DESCRIBE-CONFIGS-RESULT-ERROR-CODE
        MOVE FUNCTION ALL-ZEROES TO WS-DESCRIBE-CONFIGS-RESULT-CONFIGS
    END-IF.

DESCRIBE-BROKER-CONFIG.
    IF WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS NULL OR WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS SPACES
        PERFORM CREATE-RESPONSE-CONFIG USING CONFIG-DYNAMIC-DEFAULT-CONFIGS, FALSE, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
    ELSE IF RESOURCE-NAME-TO-BROKER-ID(WS-DESCRIBE-CONFIGS-RESOURCE-NAME) = CONFIG-BROKER-ID
        PERFORM CREATE-RESPONSE-CONFIG USING WS-CONFIG, TRUE, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
    ELSE
        RAISE INVALID-REQUEST-EXCEPTION
    END-IF.

DESCRIBE-BROKER-LOGGER-CONFIG.
    IF WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS NULL OR WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS SPACES
        RAISE INVALID-REQUEST-EXCEPTION
    ELSE IF RESOURCE-NAME-TO-BROKER-ID(WS-DESCRIBE-CONFIGS-RESOURCE-NAME) <> CONFIG-BROKER-ID
        RAISE INVALID-REQUEST-EXCEPTION
    ELSE
        PERFORM CREATE-RESPONSE-CONFIG USING LOGGING-CONTROLLER-LOGGERS, FALSE, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
    END-IF.

DESCRIBE-CLIENT-METRICS-CONFIG.
    IF WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS NULL OR WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS SPACES
        RAISE INVALID-REQUEST-EXCEPTION
    ELSE
        MOVE CONFIG-REPOSITORY-CONFIG(CONFIG-RESOURCE-TYPE-CLIENT-METRICS, WS-DESCRIBE-CONFIGS-RESOURCE-NAME) TO WS-CLIENT-METRICS-PROPS
        PERFORM CREATE-RESPONSE-CONFIG USING WS-CLIENT-METRICS-PROPS
    END-IF.

DESCRIBE-GROUP-CONFIG.
    IF WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS NULL OR WS-DESCRIBE-CONFIGS-RESOURCE-NAME IS SPACES
        RAISE INVALID-REQUEST-EXCEPTION
    ELSE
        MOVE CONFIG-REPOSITORY-GROUP-CONFIG(WS-DESCRIBE-CONFIGS-RESOURCE-NAME) TO WS-GROUP-PROPS
        MOVE GROUP-CONFIG-FROM-PROPS(CONFIG-GROUP-COORDINATOR-CONFIG-EXTRACT-GROUP-CONFIG-MAP(CONFIG-SHARE-GROUP-CONFIG), WS-GROUP-PROPS) TO WS-GROUP-CONFIG
        PERFORM CREATE-RESPONSE-CONFIG USING WS-GROUP-CONFIG, WS-GROUP-PROPS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
    END-IF.

CREATE-RESPONSE-CONFIG.
    PERFORM VARYING I FROM 1 BY 1 UNTIL I > WS-CONFIG-ENTRIES-COUNT
        IF WS-DESCRIBE-CONFIGS-RESOURCE-CONFIGURATION-KEYS IS NULL OR WS-DESCRIBE-CONFIGS-RESOURCE-CONFIGURATION-KEYS IS SPACES OR WS-CONFIG-ENTRY-NAME(I) IN WS-DESCRIBE-CONFIGS-RESOURCE-CONFIGURATION-KEYS
            PERFORM CREATE-CONFIG-ENTRY USING WS-CONFIG-ENTRY-NAME(I), WS-CONFIG-ENTRY-VALUE(I)
            MOVE WS-DESCRIBE-CONFIGS-RESOURCE-RESULT TO WS-AUTHORIZED-CONFIGS(WS-AUTHORIZED-CONFIGS-COUNT)
            ADD 1 TO WS-AUTHORIZED-CONFIGS-COUNT
        END-IF
    END-PERFORM.
    MOVE NONE-ERROR-CODE TO WS-DESCRIBE-CONFIGS-RESULT-ERROR-CODE.

CREATE-CONFIG-ENTRY.
    EVALUATE CONFIG-TYPE
    WHEN CONFIG-TYPE-TOPIC
        PERFORM CREATE-TOPIC-CONFIG-ENTRY USING PARAM1, PARAM2, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
        MOVE WS-DESCRIBE-CONFIGS-RESOURCE-RESULT TO RETURN-CODE
    WHEN CONFIG-TYPE-BROKER
        PERFORM CREATE-BROKER-CONFIG-ENTRY USING PARAM1, PARAM2, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
        MOVE WS-DESCRIBE-CONFIGS-RESOURCE-RESULT TO RETURN-CODE
    WHEN CONFIG-TYPE-GROUP
        PERFORM CREATE-GROUP-CONFIG-ENTRY USING PARAM1, PARAM2, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-SYNONYMS, WS-DESCRIBE-CONFIGS-REQUEST-INCLUDE-DOCUMENTATION
        MOVE WS-DESCRIBE-CONFIGS-RESOURCE-RESULT TO RETURN-CODE
    END-EVALUATE.

CREATE-TOPIC-CONFIG-ENTRY.
    MOVE CONFIG-TYPE(PARAM1) TO WS-CONFIG-ENTRY-TYPE.
    MOVE KAFKA-CONFIG-MAYBE-SENSITIVE(WS-CONFIG-ENTRY-TYPE) TO WS-CONFIG-ENTRY-IS-SENSITIVE.
    MOVE CONFIG-DEF-CONVERT-TO-STRING(PARAM2, WS-CONFIG-ENTRY-TYPE) TO WS-CONFIG-ENTRY-VALUE.
    PERFORM VARYING J FROM 1 BY 1 UNTIL J > WS-TOPIC-PROPS-COUNT
        IF WS-TOPIC-PROP-NAME(J) = PARAM1
            MOVE TOPIC-CONFIG TO WS-CONFIG-ENTRY-SOURCE
            MOVE WS-TOPIC-PROP-VALUE(J) TO WS-CONFIG-ENTRY-VALUE
            EXIT PERFORM
        END-IF
    END-PERFORM.
    MOVE WS-CONFIG-ENTRY-NAME TO WS-