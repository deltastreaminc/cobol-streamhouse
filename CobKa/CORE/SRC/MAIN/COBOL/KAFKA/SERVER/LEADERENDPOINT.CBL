IDENTIFICATION DIVISION.
PROGRAM-ID. LEADER-END-POINT.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    COPY KAFKA-SERVER-COPYBOOK.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 IS-TRUNCATION-ON-FETCH-SUPPORTED PIC X(01) VALUE 'Y'.
01 BROKER-END-POINT PIC X(50).

PROCEDURE DIVISION.

INITIALIZE-CLOSE.
    PERFORM INITIATE-CLOSE.
    PERFORM CLOSE.

INITIATE-CLOSE.
    MOVE SPACES TO BROKER-END-POINT.

CLOSE.
    MOVE SPACES TO BROKER-END-POINT.

GET-BROKER-END-POINT.
    MOVE 'host:port' TO BROKER-END-POINT.

FETCH.
    MOVE FUNCTION WHEN-COMPILED TO BROKER-END-POINT.
    PERFORM FETCH-FROM-LEADER.

FETCH-FROM-LEADER.
    MOVE CORRESPONDING FETCH-REQUEST TO FETCH-RESPONSE.
    RETURN FETCH-RESPONSE.

FETCH-EARLIEST-OFFSET.
    MOVE CORRESPONDING TOPIC-PARTITION TO OFFSET-AND-EPOCH.
    RETURN OFFSET-AND-EPOCH.

FETCH-LATEST-OFFSET.
    MOVE CORRESPONDING TOPIC-PARTITION TO OFFSET-AND-EPOCH.
    RETURN OFFSET-AND-EPOCH.

FETCH-EPOCH-END-OFFSETS.
    MOVE CORRESPONDING PARTITION-MAP TO EPOCH-END-OFFSET-MAP.
    RETURN EPOCH-END-OFFSET-MAP.

FETCH-EARLIEST-LOCAL-OFFSET.
    MOVE CORRESPONDING TOPIC-PARTITION TO OFFSET-AND-EPOCH.
    RETURN OFFSET-AND-EPOCH.

BUILD-FETCH.
    MOVE CORRESPONDING PARTITION-FETCH-STATE-MAP TO REPLICA-FETCH.
    RETURN REPLICA-FETCH.

STOP RUN.